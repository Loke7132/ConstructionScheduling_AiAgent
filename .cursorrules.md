# Rules for Generating the Construction Scheduling Agent

This document outlines the rules and constraints that must be followed to generate the Python script for the AI Construction Scheduling Agent.

## 1. General Principles

1.  **Strict Adherence to the Plan:** The generated code must strictly follow the architecture and components outlined in `plan.md`. No architectural deviations are permitted.
2.  **Single, Self-Contained Script:** The entire solution must be delivered as a single, executable Python script named `construction_agent.py`.
3.  **Completeness is Mandatory:** All functions, classes, and methods must be fully implemented. No placeholder functions or `pass` statements are allowed in the final output. The script must be ready to run.

## 2. Security & Configuration

1.  **No Hardcoded Secrets:** API keys MUST NOT be hardcoded in the script. They must be loaded from environment variables using `os.environ.get()`. This is a critical security requirement.
2.  **Clear User Configuration Section:** The `main()` function must contain a clearly marked "CONFIGURATION" block where the user is prompted to provide their specific API keys and document file paths.
3.  **Graceful Failure on Missing Configuration:** If required API keys or valid document paths are not provided, the script must print a clear, user-friendly error message and exit gracefully, rather than crashing.

## 3. Architectural Integrity

1.  **Enforce Modularity:** The core components—`CerebrasAPIKeyRotator`, `ScheduleState`, and `Llama70BWithRotation`—must be implemented as distinct, separate Python classes as specified in the plan.
2.  **Strict Adherence to RAG+ReAct:** The agent's core logic MUST follow the "Retrieval-Augmented Generation" and "ReAct" patterns. All access to document knowledge must be performed through the `search_documents` tool, which queries the vector store. The agent's execution flow must be a ReAct loop (Thought, Action, Observation).
3.  **Explicit State Management:** The agent's working memory (the schedule) must be managed exclusively through the `ScheduleState` class. Tools like `add_task` and `add_dependency` must call methods on the `schedule_state` instance.

## 4. Code Style & Readability

1.  **PEP 8 Compliance:** All code must adhere to the PEP 8 style guide for Python.
2.  **Clear, Numbered Sections:** The script must be organized into the numbered sections outlined in the plan (e.g., `# 1. SMART API KEY ROTATOR`, `# 2. RAG PIPELINE`, etc.) to ensure high readability.
3.  **Comprehensive Comments and Docstrings:**
    - Every class and public function must have a clear docstring explaining its purpose, arguments, and what it returns.
    - Inline comments should be used to explain the *why* behind complex or non-obvious lines of code, not just restate the *what*.

## 5. Error Handling & Robustness

1.  **Robust API Call Logic:** The `_call` method within the `Llama70BWithRotation` class must be highly robust. It must:
    - Include a timeout for the `requests.post` call.
    - Specifically check for the HTTP `429` status code to trigger the API key rotation logic.
    - Handle general `requests.exceptions.RequestException` errors.
    - Include a retry mechanism that gives up after all available keys have been tried.
2.  **Handle Tool Failures:** The LangChain `AgentExecutor` must be initialized with `handle_parsing_errors=True` to prevent the agent from crashing if the LLM produces a malformed output.
3.  **Informative Logging:** Include `print()` statements at key stages of execution (e.g., when a document is being processed, when an API key is rotated, when the agent execution starts/ends) to provide visibility into the agent's status.

## 6. Dependency Management

1.  **List All Dependencies:** The script must begin with a commented-out block that clearly lists all required Python packages and the `pip install` command needed to install them.